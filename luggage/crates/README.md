TODO: Consider breaking out all the code into separate crates depending on where it runs
