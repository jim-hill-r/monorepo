modules = ["rust-stable", "postgresql-16"]
run = "cd projects/cast_cli && cargo run"

[nix]
channel = "stable-24_05"
packages = ["unzip", "dioxus-cli", "rustup"]

[deployment]
deploymentTarget = "static"
build = ["sh", "-c", "mkdir app && unzip -o $(ls -d $PWD/projects/cahokia/web/artifacts/* | tail -1) -d app && ls -A1 | grep -v -e 'app' -e '.local' -e '.cache' -e '.upm' -e '.replit' | xargs rm -rf && ls -A1"]
publicDir = "app"

[[deployment.responseHeaders]]
path = "/*"
name = "Content-Security-Policy"
value = "default-src 'none'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; connect-src 'self'; img-src 'self'; style-src 'self';base-uri 'self';form-action 'self'"

[[deployment.rewrites]]
from = "/*"
to = "/index.html"
