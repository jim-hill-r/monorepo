modules = ["rust-stable", "postgresql-16"]
run = "cd projects/cast_cli && cargo run"

[nix]
channel = "stable-24_05"
packages = ["unzip", "dioxus-cli", "rustup"]

[deployment]
deploymentTarget = "static"
build = [
  "sh",
  "-c",
  "mkdir app && cp ./projects/cahokia/web/artifacts/latest.zip app.zip && echo \"TODO: Remove all other files\" && unzip -o app.zip -d app",
]
publicDir = "app"

[[deployment.responseHeaders]]
path = "/*"
name = "Content-Security-Policy"
value = "default-src 'none'; script-src 'unsafe-inline'; connect-src 'self'; img-src 'self'; style-src 'self';base-uri 'self';form-action 'self'"

[[deployment.rewrites]]
from = "/*"
to = "/index.html"
